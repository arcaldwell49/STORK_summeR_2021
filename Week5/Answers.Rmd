---
title: 'Week 5: Correlations, t-tests, ANOVAs, oh my!'
author: "Aaron R. Caldwell"
output: 
  github_document:
    toc: TRUE
editor_options: 
  chunk_output_type: console
---

```{r setup, include=TRUE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
library(tidyverse)
```

# Week 5 Answers

This week's instructions were written in R now that everyone is aware of how to use Rmarkdown.

Now we get down to what R was created for: statistics. 

# Useful Packages

```{r}
# statistics packages
# functions simliar to tidyverse
# install.packages("easystats", repos = "https://easystats.r-universe.dev")
library(easystats)

# For ANOVAs
library(afex)

# For equivalence testing
# Download the developmental version
# devtools::install_github("arcaldwell49/TOSTER")
library(TOSTER)
```

Now, let's import the data we need for this week!

```{r}
data("sleep")
data("ChickWeight")
data("iris")
```

\newpage

# Correlations

> Let's assume you are a botanist and are interested in the relationship between different measures of flower size. You are going to use the `iris` dataset to determine the correlation between 4 different meaures: sepal length, sepal width, petal length, and petal width.

This process isn't too difficult with the `correlation` package, but we could just as easily use the base version function `cor` or `cor.test`.

```{r}
# First remove the species column
iris2 = iris %>%
  select(-Species)

correlation(iris2,
            method = "Pearson") %>%
  knitr::kable(caption = "Correlation: Pearson Coefficient")
```

\newpage

```{r}
correlation(iris2,
            method = "Spearman") %>%
  knitr::kable(caption = "Correlation: Spearman Coefficient")
```

\newpage

We can also plot the results to visualize the relationship.

```{r}
correlation(iris2,
            method = "Spearman") %>%
  summary()%>%
  plot(show_values = TRUE, show_p = TRUE, show_legend = FALSE)
```

\newpage

Fun note: you can even plot the *partial* correlations.

```{r}
# You will need ggpraph
library(ggraph)
correlation(iris2,
            partial = TRUE) %>%
  plot()
```

\newpage

## Base R approach

As I mentioned before you can use the `cor.test` is there is a particular correlation you want to test. This is useful if you do not want to create a matrix of results.

As an example, let's use `cor.test` to test the relationship between sepal length and petal length.

```{r}
sepal_length = iris$Sepal.Length
petal_length = iris$Petal.Length
test1 = cor.test(sepal_length,petal_length)
# Now we can print the result
test1

```

However, we can also use the `report` package to get a summary of the result.

```
report(test1)
```

`r report(test1)`


# t-test

> Let's compare the groups (i.e., drug) in the "sleep" dataset and see if there is a difference in the hours of sleep each night 

So, in this scenario you are trying to test if there are difference between two treatments. Let's check the data and see what it looks like.

```{r}
knitr::kable(sleep)
```

Notice how the ID repeats between treatments? That means we have a *paired* sample; meaning that each participant was exposed to **both** conditions. This means we will use a paired samples t-test to test for differences in the mean increase in the hours of sleep (`extra`).

Luckily, R makes this easy with the built in `t.test` function.

```{r}
# formula approach
ttest1 = t.test(extra ~ group,
                data = sleep,
                paired = TRUE)

# 2 vector approach

ttest2 = t.test(x = subset(sleep, group ==1)$extra,
                y = subset(sleep, group ==2)$extra,
                paired = TRUE)

ttest1
```

Again, we can use the `report` function to get a tidy text output

```
report(ttest1)
```

`r report(ttest1)`

## Non-parametric tests

Sometimes we the assumptions of a t-test (e.g., normal residuals) are not tenable. In these situations we can use a non-parametric test like the Wilcoxon signed rank test (test of ranks).

The `wilcox.test` function performs this analysis and works just like the `t.test` function.
```{r}
# formula approach
wtest1 = wilcox.test(extra ~ group,
                data = sleep,
                paired = TRUE)

# 2 vector approach

wtest2 = wilcox.test(x = subset(sleep, group ==1)$extra,
                y = subset(sleep, group ==2)$extra,
                paired = TRUE)

wtest1
```


The report function does not work for this type of result at this time, but you can get an effect size measure (rank-biserial correlation) from the `effectsize package`.

```{r}
effectsize::rank_biserial(subset(sleep, group == 1)$extra,
                          subset(sleep, group == 2)$extra)
```


## Equivalence Test

Let's say we are interested in equivalence. For example, we may have developed a new drug and want to make sure it equivalent to the old drug when it comes to extra hours of sleep. That is where the `TOSTER` package and the new `t_TOST` function can be useful. The setup is almost exactly the same; but we just

```{r}
# remember library(TOSTER)

TOSTsleep = t_TOST(
  extra ~ group,
  data = sleep,
  low_eqbound = -1,
  high_eqbound = 1,
  paired = TRUE
)

TOSTsleep

plot(TOSTsleep)
```


# ANOVA